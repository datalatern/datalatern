<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>custom color</title>

     <link rel="stylesheet" href="app/customChart/css/jPicker-1.1.6.min.css">
     <link rel="stylesheet" href="app/customChart/css/jPicker-1.1.6.css">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <!-- jvectormap -->
    <link rel="stylesheet" href="css/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="css/AdminLTE.css">
    <link rel="stylesheet" href="css/pick-a-color-1.2.3.min.css">


    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="css/_all-skins.css">
    <link rel="stylesheet" href="css/handsontable.full.min.css">

    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="app/customChart/js/jpicker-1.1.6.min.js"></script>
    <script src="app/customChart/js/echarts-3.2.3.min.js"></script>
    <script src="js/handsontable.full.min.js"></script>
    <script src="js/underscore.js"></script>
    <script src="js/pick-a-color-1.2.3.min.js"></script>
    <script src="js/tinycolor-0.9.15.min.js"></script>
    <!--<script type="text/javascript" src="app/customChart/app.js"></script>-->
    <style>
        #add_table input{
            border: none;
            width: 80px;
            font-size: 14px;
            padding: 2px;
        }
        #add_table input:hover {
            background-color: #eee;
        }

        #add_table input:focus {
            background-color: #ccf;
        }

        #add_table input:not(:focus) {
            text-align: right;
        }

        #add_table table {
            border-collapse: collapse;
        }

        #add_table td {
            border: 1px solid #999;
            padding: 0;
        }

        #add_table tr:first-child td, td:first-child {
            background-color: #ccc;
            padding: 1px 3px;
            font-weight: bold;
            text-align: center;
        }

        #add_table footer {
            font-size: 80%;
        }
    </style>
</head>

<body style="bgcolor:black">

<!--<div class=" col-sm-4 placeholder">
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>#</th>
                <th>Header</th>
                <th>Header</th>
                <th>Header</th>
                <th>Header</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1,001</td>
                <td>Lorem</td>
                <td>ipsum</td>
                <td>dolor</td>
                <td>sit</td>
            </tr>
            <tr>
                <td>1,002</td>
                <td>amet</td>
                <td>consectetur</td>
                <td>adipiscing</td>
                <td>elit</td>
            </tr>
            <tr>
                <td>1,003</td>
                <td>Integer</td>
                <td>nec</td>
                <td>odio</td>
                <td>Praesent</td>
            </tr>
            <tr>
                <td>1,003</td>
                <td>libero</td>
                <td>Sed</td>
                <td>cursus</td>
                <td>ante</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<div class=" col-sm-8 placeholder">

    <div>
        <label for="customColor">请选择图例:</label>
        <select id="typeSelector">
            <option value="line" selected="selected">折线图</option>
            <option value="bar">柱图</option>
            <option value="scatter">散点图</option>
            <option value="effectScatter">散点气泡图</option>
        </select>
        <label for="customColor">请选择图例颜色:</label>
        <span id="customColor" color="red"></span>
    </div>


    &lt;!&ndash; 为ECharts准备一个具备大小（宽高）的Dom &ndash;&gt;
    <div id="main" style="width: 600px;height:400px;"></div>
</div>-->

<div class="row">
    <div class="col-md-12">
        <div class="box">
            <div class="box-header with-border">
                <h3 class="box-title">行业销量分析</h3>
                <!-- 右边的选项 -->
                <div class="box-tools pull-right">
                    <button type="button" style="padding: 2px 12px;" id="saveOptions" class="btn btn-block btn-primary">保存</button>
                </div>
            </div>
            <!-- /.box-header -->
            <div class="box-body" style="min-height: 560px;">
                <div class="row">
                    <div class="col-md-4">
                        <div class="nav-tabs-custom" style="cursor: move;">
                            <!-- Tabs within a box -->
                            <ul class="nav nav-tabs pull-right ui-sortable-handle" id="chartsInfo">
                                <li class="">
                                    <a href="javascript:void(0)" data-toggle="tab" >图表设置</a>
                                </li>
                                <li class="active">
                                    <a href="javascript:void(0)" data-toggle="tab" >数据</a>
                                </li>
                                <li class="pull-left header">
                                    <i class="fa fa-inbox"></i> 动态交互图
                                </li>
                            </ul>
                            <div class="tab-content no-padding" id="chartsMenuContent">
                                <!-- Morris chart - Sales -->
                                <div class="chart tab-pane active" id="dataContent"
                                     style="position: relative; min-height: 500px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
                                    <div id="add_table">
                                    </div>
                                </div>
                                <div class="chart tab-pane " id="optionContent"
                                     style="position: relative; min-height: 500px;">
                                    <div id="add_options">
                                        <div class="box box-solid">
                                            <!--<div class="box-header with-border">
                                                <h3 class="box-title">Collapsible Accordion</h3>
                                            </div>-->
                                            <!-- /.box-header -->
                                            <div class="box-body">
                                                <div class="box-group" id="accordion">
                                                    <!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->
                                                    <div class="panel box box-primary">
                                                        <div class="box-header with-border">
                                                            <h4 class="box-title">
                                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" class="collapsed">
                                                                    坐标轴映射
                                                                </a>
                                                            </h4>
                                                        </div>
                                                        <div id="collapseOne" class="panel-collapse collapse in" aria-expanded="true">
                                                            <div class="box-body">
                                                                <div id="chartsTypes" style="padding-left: 20px;">
                                                                    <label class="col-md-4 ">图表类型</label>
                                                                    <div class="form-group col-md-8">
                                                                        <select class="col-md-10 ">
                                                                            <option data-type="line" selected="">line</option>
                                                                            <option data-type="bar" selected="true">bar</option>
                                                                            <option data-type="scatter" selected="">scatter</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div id="xAxisRefer" style="padding-left: 20px;">
                                                                    <label class="col-md-4 ">x轴映射</label>
                                                                    <div class="form-group col-md-8">
                                                                        <select class=" col-md-10" id="xAxisRef">
                                                                            <!--<option disabled selected value="0">default</option>-->
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                              <!--  <div id="yAxisRefer" style="padding-left: 60px;">
                                                                    <label class="col-md-4 ">y轴映射</label>
                                                                    <div class="form-group col-md-8">
                                                                        <select class="col-md-10 " id="yAxisRef">

                                                                        </select>
                                                                    </div>
                                                                </div>-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="panel box box-danger">
                                                        <div class="box-header with-border">
                                                            <h4 class="box-title">
                                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" class="collapsed" aria-expanded="false">
                                                                    主要配置
                                                                </a>
                                                            </h4>
                                                        </div>
                                                        <div id="collapseTwo" class="panel-collapse collapse in" aria-expanded="true" >
                                                            <div class="box-body">
                                                                <div id="colorPicker" style="padding-left: 20px;">
                                                                    <label class="col-md-2 ">颜色</label>
                                                                    <div id="colorContent" class="form-group col-md-10" style="display: inline-block">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="panel box box-success">
                                                        <div class="box-header with-border">
                                                            <h4 class="box-title">
                                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" class="" aria-expanded="true">
                                                                    基本设置
                                                                </a>
                                                            </h4>
                                                        </div>
                                                        <div id="collapseThree" class="panel-collapse collapse in" aria-expanded="true">
                                                            <div class="box-body">
                                                                <div id="mainTitleName" style="padding-left: 20px;">
                                                                    <label class="col-md-4 ">主标题</label>
                                                                    <!--<div class="switch" data-on="primary" data-off="info">-->
                                                                        <!--<input type="checkbox" name="chk_title" checked />-->
                                                                    <!--</div>-->
                                                                    <input class="col-md-8" placeholder="请输入主标题名称" type="text">
                                                                </div>
                                                                <!--<div id="subTitleName" style="padding-left: 60px;">
                                                                    <label class="col-md-4 ">副标题名称</label>
                                                                    <input class="col-md-8 " placeholder="请输入副标题名称" type="text">
                                                                </div>-->
                                                                <div  style="padding-left: 20px;">
                                                                    <label class="col-md-4 ">图例位置</label>
                                                                    <div  class="form-group col-md-8">
                                                                        <select id="lengendPosition" class="col-md-12 ">
                                                                            <option >上中</option>
                                                                            <option >下中</option>
                                                                            <option selected>左上</option>
                                                                            <option>右上</option>
                                                                            <option>右下</option>
                                                                            <option>左下</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div  style="padding-left: 20px;">
                                                                    <label class="col-md-4 ">图例摆放</label>
                                                                    <div class="form-group col-md-8">
                                                                        <select id="lengendDir" class="col-md-12 ">
                                                                            <option data-dir="horizontal" selected>竖直</option>
                                                                            <option data-dir="vertical" >水平</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- /.box-body -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <p class="text-center">
                            <strong id="strongtitle" style="font-size: 30px;"></strong><br>
                            <strong id="strongSubtitle" style="font-size: 20px;"></strong>
                        </p>

                        <div class="chart" id="main" style="min-height: 600px;">


                        </div>
                        <!-- /.chart-responsive -->
                    </div>
                    <!-- /.col -->

                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </div>
            <!-- ./box-body -->
        <!--    <div class="box-footer">
                <div class="row">
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block border-right">
                            <span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 17%</span>
                            <h5 class="description-header">$35,210.43</h5>
                            <span class="description-text">TOTAL REVENUE</span>
                        </div>
                        &lt;!&ndash; /.description-block &ndash;&gt;
                    </div>
                    &lt;!&ndash; /.col &ndash;&gt;
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block border-right">
                            <span class="description-percentage text-yellow"><i class="fa fa-caret-left"></i> 0%</span>
                            <h5 class="description-header">$10,390.90</h5>
                            <span class="description-text">TOTAL COST</span>
                        </div>
                        &lt;!&ndash; /.description-block &ndash;&gt;
                    </div>
                    &lt;!&ndash; /.col &ndash;&gt;
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block border-right">
                            <span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 20%</span>
                            <h5 class="description-header">$24,813.53</h5>
                            <span class="description-text">TOTAL PROFIT</span>
                        </div>
                        &lt;!&ndash; /.description-block &ndash;&gt;
                    </div>
                    &lt;!&ndash; /.col &ndash;&gt;
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block">
                            <span class="description-percentage text-red"><i class="fa fa-caret-down"></i> 18%</span>
                            <h5 class="description-header">1200</h5>
                            <span class="description-text">GOAL COMPLETIONS</span>
                        </div>
                        &lt;!&ndash; /.description-block &ndash;&gt;
                    </div>
                </div>
                &lt;!&ndash; /.row &ndash;&gt;
            </div>-->
            <!-- /.box-footer -->
        </div>
        <!-- /.box -->
    </div>
    <!-- /.col -->
</div>

</body>
<script>
    var data=[
        ["星期","访问量","访问类型"],
        ["周一","120","邮件营销"],
        ["周二","112","邮件营销"],
        ["周三","212","邮件营销"],
        ["周四","132","邮件营销"],
        ["周五","242","邮件营销"],
        ["周六","290","邮件营销"],
        ["周日","110","邮件营销"],

        ["周一","101","联盟广告"],
        ["周二","122","联盟广告"],
        ["周三","322","联盟广告"],
        ["周四","284","联盟广告"],
        ["周五","276","联盟广告"],
        ["周六","280","联盟广告"],
        ["周日","210","联盟广告"],

        ["周一","219","视频广告"],
        ["周二","217","视频广告"],
        ["周三","118","视频广告"],
        ["周四","139","视频广告"],
        ["周五","272","视频广告"],
        ["周六","240","视频广告"],
        ["周日","310","视频广告"],
    ];
    //判断是否有傻逼用户不点击图表配置就保存的行为，如果有，就默认配置一遍图表
    var clickTag=false;
    var container = document.getElementById('add_table');

    var hot = new Handsontable(container, {
        data: data,
        minSpareCols: 1,
        minSpareRows: 1,
        rowHeaders: true,
        colHeaders: true,
        contextMenu: true
    });
    $(function () {
        /*var data = [
            ["", "周一", "周二", "周三", "周四","周五","周六","周日"],
            ["邮件营销", 120, 112, 212, 132,242,290,110],
            ["联盟广告", 101, 122, 322, 284,276,280,210],
            ["视频广告", 219, 217, 118, 139,272,240,310],
        ];*/
        init();
        initEvent();
    });

    function init() {
        drawChartsOptions(data);
        createcharts(getChartsOptions());
    }
    function initEvent() {
        $("#chartsInfo li a").on("click",function (evt) {
            var that=$(evt.target);
            that.parent().siblings().removeClass("active");
            that.parent().addClass("active");
            if(that.html()==="图表设置"){
                $("#optionContent").addClass("active");
                $("#dataContent").removeClass("active");
                data=hot.getData();
                drawChartsOptions(data);
                clickTag=true;
            }else if(that.html()==="数据"){
                $("#dataContent").addClass("active");
                $("#optionContent").removeClass("active");
                clickTag=false;
            }
        });
        $("#saveOptions").on("click",function () {
            data=hot.getData();
            if(clickTag===false){
                drawChartsOptions(data);
                createcharts(getChartsOptions());
            }else{
                createcharts(getChartsOptions());
            }
        });

    }
    var dataType=[];//数据类型==> 访问类型
    var dataXyAxis=[];
    var dataTree=[];//根据数据类型变成树形结构
    //绘制左边options框
    function drawChartsOptions(vdata) {
        dataType=[];//数据类型==> 访问类型
        dataXyAxis=[];
        dataTree=[];
        vdata.map(function (v,i) {
           if(i===0){
               dataXyAxis.push(v[0]);
               dataXyAxis.push(v[1]);
           }else{
               dataType.push(v[2]);
           }
        });
        dataType=_.uniq(dataType);
        dataType=_.compact(dataType);

        for(var i=0;i<dataType.length;i++){
            dataTree.push({
                name:dataType[i],
                data:[]
            });
        }
        for(var j=0;j<dataTree.length;j++){
            vdata.map(function (v,i) {
                if(i>0){
                    if(v[2]===dataTree[j].name){
                        dataTree[j].data.push(_.compact(v))
                    }
                }
            });
        }

        var xyAxisRefHTML="";
        dataXyAxis.map(function (v,i) {
           xyAxisRefHTML+='<option >'+v+'</option>';
        });
        $("#xAxisRef").html(xyAxisRefHTML);
        //$("#yAxisRef").html(xyAxisRefHTML);
        var colorTypeHTML="";
        var randomColors=['#c23531','#2f4554', '#61a0a8', '#d48265', '#91c7ae','#749f83',  '#ca8622', '#bda29a','#6e7074', '#546570', '#c4ccd3'];
        dataType.map(function (v,i) {
            colorTypeHTML+='<label>'+v+':</label><input type="text" value="'+randomColors[Math.floor(Math.random()*7)].substring(1)+'" name="border-color" class="pick-a-color form-control">'
        });
        $("#colorContent").html(colorTypeHTML);
        $(".pick-a-color").pickAColor();
        //console.log(dataTree);
    }
    //获取左边options框中的内容，为绘制图表做准备
    function getChartsOptions() {
        var optionsObj={};
        optionsObj.chartType=$("#chartsTypes select").val();
        optionsObj.xAxisRef=$("#xAxisRefer select").val();
        optionsObj.yAxisRef=$("#yAxisRefer select").val();
        optionsObj.colors=[];
        $(".pick-a-color").each(function(index,value){
            optionsObj.colors.push("#"+$(value).val());
        });
//        console.log(optionsObj.colors);
        optionsObj.mainTitle=$("#mainTitleName input").val();
        optionsObj.subTitle=$("#subTitleName input").val();
        optionsObj.lengendPosition=$("#lengendPosition").find("option:selected").text();
        optionsObj.lengendDir=$("#lengendDir").find("option:selected").attr("data-dir");
        return optionsObj;
    }
    //绘制图表
    function createcharts(optionObj) {
        var that=optionObj;
        var chartsdom=document.getElementById("main");
        var mycharts=echarts.init(chartsdom);
        var xAxisdata=[].concat=(dataTree[0].data.map(function (v) {
            return  v[0];
        }));
        var seriesdata=[];
        dataTree.map(function (v,i) {
            var tempOpt={
                name:v.name,
                type:that.chartType,
                data:[].concat=(dataTree[i].data.map(function (v) {
                    return  v[1];
                }))
            }
            seriesdata.push(tempOpt);
        });
        //console.log(xAxisdata);
        $("#strongtitle").html(that.mainTitle);
        $("#strongSubtitle").html(that.subTitle);
        var lengendOption={};
        switch (that.lengendPosition){
            case "上中" :
                lengendOption={
                    data:dataType,
                    left:"center",
                    top:"top",
                    orient:that.lengendDir,
                    selectedMode:false,
                };
                break;
            case "下中" :
                lengendOption={
                    data:dataType,
                    left:"center",
                    top:"bottom",
                    orient:that.lengendDir,
                    selectedMode:false,
                };
                break;
            case "左上" :
                lengendOption={
                    data:dataType,
                    left:"left",
                    top:"top",
                    orient:that.lengendDir,
                    selectedMode:false,
                };
                break;
            case "右上" :
                lengendOption={
                    data:dataType,
                    left:"right",
                    top:"top",
                    orient:that.lengendDir,
                    selectedMode:false,
                };
                break;
            case "左下" :
                lengendOption={
                    data:dataType,
                    left:"left",
                    top:"bottom",
                    orient:that.lengendDir,
                    selectedMode:false,
                };
                break;
            case "右下" :
                lengendOption={
                    data:dataType,
                    left:"right",
                    top:"bottom",
                    orient:that.lengendDir,
                    selectedMode:false,
                };
                break;
        }
        var option={
            /*tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },*/
            color:that.colors,
            legend: lengendOption,
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis : [
                {
                    type : "category",
                    data : xAxisdata
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : seriesdata
        };
        mycharts.setOption(option);
    }

</script>
</html>